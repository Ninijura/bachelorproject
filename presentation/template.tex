%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Focus Beamer Presentation
% LaTeX Template
% Version 1.0 (8/8/18)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Pasquale Africa (https://github.com/elauksap/focus-beamertheme) with modifications by 
% Vel (vel@LaTeXTemplates.com)
%
% Template license:
% GNU GPL v3.0 License
%
% Important note:
% The bibliography/references need to be compiled with bibtex.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{beamer}

\usetheme{focus} % Use the Focus theme supplied with the template
% Add option [numbering=none] to disable the footer progress bar
% Add option [numbering=fullbar] to show the footer progress bar as always full with a slide count

% Uncomment to enable the ice-blue theme 
%\definecolor{main}{RGB}{92, 138, 168}
%\definecolor{background}{RGB}{240, 247, 255}

%------------------------------------------------

\usepackage{booktabs} % Required for better table rules
\usepackage{tikz-cd}
\usepackage{stmaryrd} % For interpretation bracket (and maybe other stuff)
%\usepackage[uft-8]{inputenc}

%----------------------------------------------------------------------------------------
%	 TITLE SLIDE
%----------------------------------------------------------------------------------------

\title{Exploring interpretations \\ of probabilistic programs \\ using measure theory in Coq}

%\subtitle{}

\author{Kira Kutscher \& Lasse Letager Hansen}

%\institute{Aarhus University}

\date{28th of June, 2019}

%------------------------------------------------

\begin{document}
\newcommand\rml{$\mathcal{R}$\texttt{ml}} % for a pretty version of "Rml"
\maketitle

%------------------------------------------------

\begin{frame}{This talk}
  We will...
  \pause
  \begin{itemize}
      \item be motivated by cryptography;
  \pause
      \item look at some previous work presenting the probabilistic languages \rml\
    and \texttt{pwhile};
  \pause
      \item study the theory of how to interpret probabilistic definitions as well as
    general recursion in the deterministic and certainly terminating Coq; 
  \pause
    \item see how this theory is employed in the semantics of \rml\ and \texttt{pwhile};
  \pause
    \item get a quick overview of how we used this in our project. 
  \end{itemize}
\end{frame}

%------------------------------------------------

\begin{frame}{Motivation}
  Probabilistic algorithms are widely used and important...\\
    \pause
    ...but much less widely proven correct.\\
    \bigskip
    \pause
    We aim towards:
    \pause
    \begin{itemize}
        \item Mechanising proofs
      \pause
        \item Making proofs reliable
      \pause
        \item Making the process of correctness proofs accessible. 
    \end{itemize}
    \pause
    \bigskip
    \medskip
    Did we achieve this?
    \pause
    \begin{flushright}
      No... but we made a step towards it. 
    \end{flushright}
\end{frame}

%------------------------------------------------

\section{The shoulders of giants}
%Many people. Most famously Newton

%------------------------------------------------

\begin{frame}{Two languages}
  \begin{columns}
    \column{0.5\textwidth}
    \LARGE{\rml}\tiny{\cite{rml-paper}}
    \hrule
    \column{0.5\textwidth}
    \LARGE{\texttt{pwhile}}\tiny{\cite{easy-crypt}}
    \vspace{-0.5em}
    \hrule
  \end{columns}
  \pause
  \begin{columns}
    \column{0.5\textwidth}
    \begin{itemize}
        \item functional
        \item designed as part of the ALEA library
        \item no implementation publicly available
    \end{itemize}
    \pause
    \column{0.5\textwidth}
    \begin{itemize}
        \item imperative
        \item designed as the definition language in \textsc{EasyCrypt}
        \item implemented in Coq in the \texttt{xhl} development by Pierre-Yves
      Strub
    \end{itemize}
  \end{columns}
\end{frame}

% ------------------------------------------------

\begin{frame}{\rml}
  
\begin{align*}
  exp~::=&~ ~ x~\vert ~ c~\vert ~ \texttt{if }b\texttt{ then }e_1\texttt{ else } e_2~\\
  &\vert ~ \texttt{let }x = e_1 \texttt{ in }e_2~\vert ~ f~e_1~\dots~e_n
\end{align*}

Probabilistic functions are \texttt{flip} and \texttt{random $n$}. 
\end{frame}

% ------------------------------------------------

\begin{frame}{\texttt{pwhile}}
  
\begin{align*}
  exp ::=~& x ~\vert ~ const ~\vert ~ \texttt{prp ($p$ : pred mem)}~\vert ~ e_1\ e_2\\
  cmd ::=~& \texttt{abort} ~\vert ~ \texttt{skip} ~\vert ~ x := e ~\vert ~ x\ \$\hspace{-0.25em}= e\\
  \vert ~ & \texttt{if } b \texttt{ then } c_1 \texttt{ else } c_2 ~\vert ~
            \texttt{while } b \texttt{ do } c ~\vert ~ c_1 ; c_2
\end{align*}
Probabilistic functions are \texttt{flip} and \texttt{random $n$}. 
\end{frame}

% ------------------------------------------------

\begin{frame}{Combining both approaches}
  \begin{center}
    \begin{tikzcd}
      \texttt{pwhile} \arrow[rr] \arrow[d]
      \pgfmatrixnextcell \pgfmatrixnextcell  \omega\text{-cpos} \\
      \text{\rml} \arrow[rru]    
    \end{tikzcd}
  \end{center}
\end{frame}

% ------------------------------------------------

\section{The most practical solution\\
is a [bit of] good theory}
%Albert Einstein

% ------------------------------------------------

\begin{frame}{Probabilistic definitions}
  A measure is a function on a set that:
  \begin{itemize}
      \item has $\mathbb{R}^+$ as its codomain;
      \item has value 0 for the empty set
      \item is countably additive
  \end{itemize}
  \bigskip
  \pause
  A measure on type $\tau$ if $f~:~\tau\to\mathbb{R}^+$: $\int f~d\mu$ \\
  \bigskip
  \pause
  The type of a measure on $\tau$ is $(\tau\to\mathbb{R}^+)\to\mathbb{R}^+$
\end{frame}

% ------------------------------------------------

\begin{frame}{The measure monad}
  \begin{align*}
    \texttt{unit} & :~ \tau\to\texttt{M}\tau\\
                  & = \texttt{fun }(x:\tau)\Rightarrow
                    \texttt{fun }(f~:~\tau\to[0,1])\Rightarrow f~x\\
    \\
    \texttt{bind} & :~\texttt{M}\tau\to(\tau\to\texttt{M}\sigma)\to\texttt{M}\sigma\\
                  & = \texttt{fun }(\mu~:~\texttt{M}\tau)\Rightarrow \texttt{fun }
                    (g~:~\tau\to\texttt{M}\sigma) \Rightarrow\\
                  & ~~~~~\texttt{fun }(f~:~\sigma\to[0,1])\Rightarrow \mu~ (\texttt{fun
                    }(x~:~\tau)\Rightarrow M~x~f)
  \end{align*}
\end{frame}

% ------------------------------------------------

\begin{frame}{Fixpoint iterations}
  $$\textit{fac}(n) := \texttt{ if } n = 0 \texttt{ then }1\texttt{ else } n\cdot
  \textit{fac}(n-1)$$
  \pause
  $$F(g(n)):=\texttt{ if }n=0\texttt{ then }1\texttt{ else }n\cdot g(n-1)$$
  \pause
  \begin{align*}
    \hspace{0.6em}
    F_1(n) = F(F_0(n)) & = \begin{cases}
      1~~~\text{if }n\text{ is 0}\\
      0~~~\text{otherwise}
    \end{cases}
  \end{align*}
  \pause
  \vspace{-1em}
  \begin{align*}
    F_2(n) = F(F(F_0(n))) & = \begin{cases}
      1~~~\text{if }n\text{ is 0 or 1}\\
      0~~~\text{otherwise}
    \end{cases}
  \end{align*}
  \pause
  \vspace{-1em}
  \begin{align*}
    F_3(n) = F(F(F(F_0(n)))) & = \begin{cases}
      1~~~\text{if }n\text{ is 0 or 1}\\
      2~~~\text{if }n\text{ is 2}\\
      0~~~\text{otherwise}\hspace{2em}
    \end{cases}
  \end{align*}
  \pause
  \vspace{-1em}
  \begin{align*}
    \vdots \hspace{5em} \vdots \hspace{5em} \hspace{3em}\vdots\hspace{5em}
  \end{align*}
\end{frame}

% ------------------------------------------------

\begin{frame}{$\omega$-cpos}
  \begin{align*}
    X & \text{ : a set}\\
    \leq & \text{ : reflexivie, transitive, antisymmetric}\\
    0_X &\text{ : } \forall x \in X : 0 \leq x\\
    \texttt{lub}_X &~~\text{ for monotonic sequences}\\
  \end{align*}
\end{frame}

% ------------------------------------------------

\begin{frame}{Measures are $\omega$-cpos}
  \begin{align*}
    (\tau\to[0,1])\to[0,1]
  \end{align*}
  \pause
  \begin{center}
    is an $\omega$-cpo, since the definition can be extended to function spaces: 
  \end{center}
  \pause
  \begin{align*}
    f\leq_{A \to B} g \Leftrightarrow \forall x: f(x) \leq_B g(x)
    & ~~~\textit{(pointwise order)}\\
    0_{A\to B} := f(x) = 0_B
    & ~~~\textit{(least element)}\\
    \texttt{lub}_{A\to B} f_n := \texttt{lub}_B(f_n(x))
    & ~~~\textit{(least upper bound operation)}
  \end{align*}
\end{frame}

% ------------------------------------------------

\section{A language is not just words}
%Noam Chomsky

% ------------------------------------------------

\begin{frame}{Semantics of \rml}
  \begin{align*}
    v
    &\mapsto \texttt{unit }v ~~ (v \text{ variable or constant})\\ \\
    \texttt{let }x=a\texttt{ in } b
    &\mapsto \texttt{bind }[a]~(\texttt{fun } x \Rightarrow [b])\\ \\
    f~a_1\dots a_n
    &\mapsto \texttt{bind }[a_1]~(\texttt{fun } x_1 \Rightarrow \dots \texttt{bind }[a_n]
    \\ 
    &\hspace{2em} (\texttt{fun } x_n \Rightarrow [f]~x_1 \dots x_n) \dots ) \\\\
    \texttt{if $b$ then $a_1$ else $a_2$}
    &\mapsto  \texttt{bind } [b]~(\texttt{fun } x~:~\texttt{bool}) \Rightarrow\\
    &\hspace{2em} (\texttt{if $x$ then $[a_n]$ else $[a_2]$})
  \end{align*}
\end{frame}

% ------------------------------------------------

\begin{frame}{Semantics of \texttt{pwhile}}
  \begin{align*}
    \llbracket \texttt{abort} \rrbracket~m
    &\mapsto \texttt{dnull}\\
    \llbracket \texttt{skip} \rrbracket~m
    &\mapsto \texttt{unit }m\\
    \llbracket i;~c \rrbracket~m
    &\mapsto \texttt{bind }(\llbracket i \rrbracket~m) ~
      \llbracket c \rrbracket \\
    \llbracket x := e \rrbracket~m
    &\mapsto \texttt{unit }m [\llbracket e \rrbracket~m / x]\\
    \llbracket x~\$= d \rrbracket~m
    &\mapsto \texttt{bind } (\llbracket d \rrbracket~m) ~(\lambda v.\texttt{unit }m[v/x])
    \\ 
    \hspace{-1.5em}\llbracket \texttt{if $e$ then $c_1$ else $c_2$} \rrbracket~m
    &\mapsto \begin{cases} \llbracket c_1 \rrbracket~m\text{ if} \llbracket e
           \rrbracket~m = \texttt{true}\\ 
           \llbracket c_2 \rrbracket~m\text{ if} \llbracket e \rrbracket~m =
           \texttt{false}\\ 
         \end{cases}\\
    \llbracket \texttt{while $e$ do $c$} \rrbracket~m
    &\mapsto \lambda f.\text{sup}~(\lambda n. \llbracket [\texttt{while $e$ do }c]_n
      \rrbracket)~ m~f)\\
    & ~~~~~~ \text{where}\\
    & ~~~~~~ [\texttt{while $e$ do }c]_0 ~~~ = \texttt{skip}\\
    & ~~~~~~ [\texttt{while $e$ do }c]_{n+1} = \texttt{if $e$ then $c$;} \\
    & \hspace{125pt}[\texttt{while $e$ do }c]_n
  \end{align*}
\end{frame}

% ------------------------------------------------

\section{Implementation beats oration}
%Aesop

% ------------------------------------------------

\begin{frame}{Our work}
  We...\pause
  \begin{itemize}
      \item developed theory about how to translate \texttt{pwhile} to \rml;
    \pause
      \item implemented an abstract syntax for \rml;
    \pause
      \item implemented a type-checker for \rml; and
    \pause
      \item implemented an interpretation of \rml. 
  \end{itemize}
\end{frame}

% ------------------------------------------------

\begin{frame}{Conclusion}
  \begin{itemize}
      \item We have a way of mathematically interpreting general recursion and
    probabilistic definitions in Coq, using a monadic structure.
    \pause
      \item We can use this in order to design languages that can be used to write
    probabilistic programs in.
    \pause
      \item We can use Coq to reason about the interpretation of probabilistic
    programs.
    \pause
      \item We have related two such languages to each other, showing that the
    semantics of one of them is a subset of that of the other. 
  \end{itemize}
\end{frame}

%----------------------------------------------------------------------------------------

\bibliographystyle{apalike}
\bibliography{sources}

\end{document}
